{% extends "layout.html" %}

{% block title %}Edit {{ data.title }}{% endblock %}

{% block content %}
<div class="container">
    <h2 class="my-4">Edit Film - {{ data.title }}</h2>

    <form id="edit-film-form">
        <div class="mb-3">
            <label for="title" class="form-label">Title:</label>
            <input type="text" id="title" name="title" class="form-control" value="{{ data.title }}" required>
        </div>

        <div class="mb-3">
            <label for="year" class="form-label">Year:</label>
            <input type="number" id="year" name="year" class="form-control" value="{{ data.year }}" required>
        </div>

        <div class="mb-3">
            <label for="director" class="form-label">Director(s):</label>
            <input type="text" id="director" name="director" class="form-control" value="{{ ', '.join(data.director) }}">
        </div>

        <div class="mb-3">
            <label for="stars" class="form-label">Stars:</label>
            <input type="text" id="stars" name="stars" class="form-control" value="{{ ', '.join(data.stars) }}">
        </div>

        <div class="mb-3">
            <label for="genres" class="form-label">Genres:</label>
            <input type="text" id="genres" name="genres" class="form-control" value="{{ ', '.join(data.genres) }}">
        </div>

        <div class="mb-3">
            <label for="rating" class="form-label">Rating:</label>
            <input type="number" id="rating" name="rating" class="form-control" value="{{ data.rating }}" required>
        </div>

        <div class="mb-3">
            <label for="summary" class="form-label">Summary:</label>
            <textarea id="summary" name="summary" class="form-control" rows="4">{{ data.summary }}</textarea>
        </div>

        <!-- Submit & Discard Buttons -->
        <button type="submit" class="btn btn-success">Save Changes</button>
        <button type="button" class="btn btn-danger" id="discard-btn">Discard Changes</button>
    </form>
</div>

<!-- JavaScript for Discard Confirmation -->
<script>
    document.getElementById('discard-btn').addEventListener('click', function () {
        if (confirm("Are you sure you want to discard changes?")) {
            window.location.href = "{{ url_for('view_data', id=data.id) }}";
        }
    });

    document.getElementById('edit-film-form').addEventListener('submit', function (event) {
        event.preventDefault();  // Prevent default form submission

        const formData = new FormData(this);
        fetch("{{ url_for('update_data', id=data.id) }}", {
            method: "POST",
            body: formData
        }).then(response => response.json()).then(data => {
            if (data.success) {
                window.location.href = "{{ url_for('view_data', id=data.id) }}";
            } else {
                alert("Error updating film. Check the fields.");
            }
        });
    });
</script>

{% endblock %}
